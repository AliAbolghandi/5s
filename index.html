<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>سامانه ارزیابی 5S</title>
  <style>
    body { font-family: Tahoma, sans-serif; background: #f0f4ff; display:flex; justify-content:center; align-items:center; min-height:100vh; }
    .container { background:white; padding:30px; border-radius:15px; width:100%; max-width:400px; box-shadow:0 10px 30px rgba(0,0,0,0.1);}
    h2 { text-align:center; margin-bottom:20px; }
    .input-group { margin-bottom:15px; }
    .input-group input { width:100%; padding:10px; border-radius:5px; border:1px solid #ccc; }
    .btn { width:100%; padding:12px; background:#4a6bdf; color:white; border:none; border-radius:5px; cursor:pointer; }
    .message { text-align:center; margin-top:10px; font-weight:500; }
    .success { color:green; }
    .error { color:red; }
    .tabs { display:flex; margin-bottom:20px; }
    .tab { flex:1; text-align:center; padding:10px; cursor:pointer; border-bottom:2px solid #ccc; }
    .tab.active { border-bottom:2px solid #4a6bdf; font-weight:bold; color:#4a6bdf; }
    .form { display:none; }
    .form.active { display:block; }
  </style>
</head>
<body>
  <div class="container">
    <h2>سامانه ارزیابی کارخانه</h2>
    
    <div class="tabs">
      <div class="tab active" onclick="showTab('login')">ورود</div>
      <div class="tab" onclick="showTab('register')">ثبت‌نام</div>
    </div>

    <!-- فرم ورود -->
    <div id="login" class="form active">
      <div class="input-group">
        <input type="tel" id="login_phone" placeholder="شماره همراه">
      </div>
      <div class="input-group">
        <input type="password" id="login_pass" placeholder="رمز عبور">
      </div>
      <button class="btn" onclick="loginUser()">ورود</button>
      <div id="login-message" class="message"></div>
    </div>

    <!-- فرم ثبت‌نام -->
    <div id="register" class="form">
      <div class="input-group">
        <input type="text" id="reg_name" placeholder="نام">
      </div>
      <div class="input-group">
        <input type="text" id="reg_family" placeholder="نام خانوادگی">
      </div>
      <div class="input-group">
        <input type="tel" id="reg_phone" placeholder="شماره همراه">
      </div>
      <div class="input-group">
        <input type="password" id="reg_pass" placeholder="رمز عبور">
      </div>
      <button class="btn" onclick="registerUser()">ثبت‌نام</button>
      <div id="reg-message" class="message"></div>
    </div>
  </div>

<script>
const scriptUrl = "https://script.google.com/macros/s/YOUR_WEB_APP_ID/exec";

function showTab(tabName){
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.form').forEach(f=>f.classList.remove('active'));
  document.getElementById(tabName).classList.add('active');
  document.querySelector(`.tab[onclick="showTab('${tabName}')"]`).classList.add('active');
  document.getElementById('login-message').textContent='';
  document.getElementById('reg-message').textContent='';
}

// ثبت‌نام
async function registerUser(){
  const name=document.getElementById('reg_name').value.trim();
  const family=document.getElementById('reg_family').value.trim();
  const phone=document.getElementById('reg_phone').value.trim();
  const pass=document.getElementById('reg_pass').value.trim();
  const msg=document.getElementById('reg-message');

  if(!name||!family||!phone||!pass){ msg.textContent='تمام فیلدها الزامی هستند.'; msg.className='message error'; return;}

  const formData=new URLSearchParams();
  formData.append('action','register');
  formData.append('reg_name',name);
  formData.append('reg_family',family);
  formData.append('reg_phone',phone);
  formData.append('reg_pass',pass);

  try{
    const response=await fetch(scriptUrl,{
      method:'POST',
      headers:{'Content-Type':'application/x-www-form-urlencoded;charset=UTF-8'},
      body:formData
    });
    const result=await response.json();
    if(result.status==='success'){
      msg.textContent='ثبت‌نام موفقیت‌آمیز بود!';
      msg.className='message success';
      document.getElementById('reg_name').value='';
      document.getElementById('reg_family').value='';
      document.getElementById('reg_phone').value='';
      document.getElementById('reg_pass').value='';
    }else{
      msg.textContent=result.message;
      msg.className='message error';
    }
  }catch(e){
    msg.textContent='خطا در ارتباط با سرور.';
    msg.className='message error';
    console.error(e);
  }
}

// ورود
async function loginUser(){
  const phone=document.getElementById('login_phone').value.trim();
  const pass=document.getElementById('login_pass').value.trim();
  const msg=document.getElementById('login-message');

  if(!phone||!pass){ msg.textContent='تمام فیلدها الزامی هستند.'; msg.className='message error'; return;}

  const formData=new URLSearchParams();
  formData.append('action','login');
  formData.append('phone',phone);
  formData.append('pass',pass);

  try{
    const response=await fetch(scriptUrl,{
      method:'POST',
      headers:{'Content-Type':'application/x-www-form-urlencoded;charset=UTF-8'},
      body:formData
    });
    const result=await response.json();
    if(result.status==='success'){
      msg.textContent='ورود موفقیت‌آمیز بود!';
      msg.className='message success';
      localStorage.setItem('user',JSON.stringify(result.user));
      setTimeout(()=>window.location.href='5squestion.html',1500);
    }else{
      msg.textContent=result.message;
      msg.className='message error';
    }
  }catch(e){
    msg.textContent='خطا در ارتباط با سرور.';
    msg.className='message error';
    console.error(e);
  }
}
</script>
</body>
</html>
