<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ثبت نام و ورود</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 50px;
    }
    .form-container {
      display: none;
    }
    .active {
      display: block;
    }
    .loading {
      display: none;
      margin-top: 10px;
    }
  </style>
</head>
<body>

  <h2>سامانه ثبت نام و ورود</h2>

  <!-- فرم ورود -->
  <div id="loginForm" class="form-container active">
    <h3>ورود</h3>
    <form onsubmit="loginUser(event)">
      <input type="text" id="loginPhone" placeholder="شماره همراه" required><br><br>
      <input type="password" id="loginPass" placeholder="رمز عبور" required><br><br>
      <button type="submit">ورود</button>
    </form>
    <p><a href="#" onclick="showRegister()">ثبت نام</a></p>
  </div>

  <!-- فرم ثبت‌نام -->
  <div id="registerForm" class="form-container">
    <h3>ثبت نام</h3>
    <form onsubmit="registerUser(event)">
      <input type="text" id="regName" placeholder="نام" required><br><br>
      <input type="text" id="regFamily" placeholder="نام خانوادگی" required><br><br>
      <input type="text" id="regPhone" placeholder="شماره همراه" required><br><br>
      <input type="password" id="regPass" placeholder="رمز عبور" required><br><br>
      <button type="submit">ثبت نام</button>
    </form>
    <p><a href="#" onclick="showLogin()">ورود</a></p>
  </div>

  <!-- لودینگ مشترک -->
  <div id="loading" class="loading">
    <p>در حال پردازش...</p>
  </div>

  <script>
    const scriptUrl = "YOUR_SCRIPT_URL"; // اینجا لینک WebApp گوگل اسکریپت رو بذار

    function showRegister() {
      document.getElementById("loginForm").classList.remove("active");
      document.getElementById("registerForm").classList.add("active");
    }

    function showLogin() {
      document.getElementById("registerForm").classList.remove("active");
      document.getElementById("loginForm").classList.add("active");
    }

    // ورود
    async function loginUser(event) {
      event.preventDefault();

      const phone = document.getElementById("loginPhone").value.trim();
      const pass = document.getElementById("loginPass").value.trim();
      const loading = document.getElementById("loading");

      try {
        loading.style.display = "block";

        const response = await fetch(scriptUrl, {
          method: "POST",
          body: new URLSearchParams({
            action: "login",
            phone,
            pass
          })
        });

        const result = await response.json();

        if (result.status === "success") {
          alert("خوش آمدید " + result.user.name + " " + result.user.family);
        } else {
          alert(result.message);
        }
      } catch (error) {
        alert("خطا در ارتباط با سرور: " + error.message);
      } finally {
        loading.style.display = "none";
      }
    }

    // ثبت‌نام
    async function registerUser(event) {
      event.preventDefault();

      const name = document.getElementById("regName").value.trim();
      const family = document.getElementById("regFamily").value.trim();
      const phone = document.getElementById("regPhone").value.trim();
      const pass = document.getElementById("regPass").value.trim();
      const loading = document.getElementById("loading");

      try {
        loading.style.display = "block";

        const response = await fetch(scriptUrl, {
          method: "POST",
          body: new URLSearchParams({
            action: "register",
            name,
            family,
            phone,
            pass
          })
        });

        const result = await response.json();

        if (result.status === "success") {
          alert(result.message);
          document.getElementById("registerForm").reset();
          showLogin();
        } else {
          alert(result.message);
        }
      } catch (error) {
        alert("خطا در ارتباط با سرور: " + error.message);
      } finally {
        loading.style.display = "none";
      }
    }
  </script>
</body>
</html>
